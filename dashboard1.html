<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0056)http://misoproject.com/dataset/examples/perlinnoise.html -->
<html class="no-js wf-fftisawebpro-n4-active wf-fftisawebpro-i4-active wf-fftisawebpro-n7-active wf-fftisawebpro-i7-active wf-facitweb-n3-active wf-facitweb-n4-active wf-facitweb-n6-active wf-facitweb-n7-active wf-active" lang="en"><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]--><!--[if gt IE 8]><!--><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript" async="" src="./js/ga.js"></script><script src="js/aow5drr.js" type="text/javascript"></script>
    <style type="text/css">.tk-ff-tisa-web-pro{font-family:"ff-tisa-web-pro",serif;}.tk-facitweb{font-family:"facitweb",sans-serif;}</style><link rel="stylesheet" href="http://use.typekit.com/k/aow5drr-d.css?3bb2a6e53c9684ffdc9a9bf41b5b2a624b88601564a934ad1670a5b6a1ccf93d7c7fb21eca8b1d1601f33f71956e5681dc4e1968e8a689593a1011eb200cdd94b91e8f56bd9877bf7fb7ddfac7e88a798bf8fc0f4cdadbb43a4175f863556fd78b22abdc969fc14101dfde7b6d556eaf8b8692b93b6e1bb939"><script type="text/javascript">
      try{ Typekit.load(); } catch(e) {}
    </script>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="The Miso Project" name="description">
    <meta content="The Miso Project" name="name">
    <meta content="width=device-width" name="viewport">
    <title>The Miso Project :: Dataset :: Examples</title>
    <link href="css/screen.css" rel="stylesheet">
    <link href="css/codemirror.css" rel="stylesheet">
    
  </head>
  <body>
    <nav>
      <span class="miso">
        <a href="#">
          ‚Üê Home
        </a>
      </span>
      <span class="miso">
        <a href="#">
          Help
        </a>
      </span>
    </nav>
    <article class="dataset example">
      <section class="normal">
        <h2>Dashboard Example: Status Heatmap</h2>
        <p>
           Following the example of Facebook
            (see the the post <a href"https://www.facebook.com/notes/facebook-engineering/monitoring-cache-with-claspin/10151076705703920">Monitoring cache with Claspin</a> in the Facebook Engineering blog) we use a Heatmap in order to vizualize the status codes of various checks of our infrastructure. 
        </p>
        <div id="legend" style="float:right;"></div>
        <div id="perlinContainer" style="height: 300px; width: 600px;">
          
        <div class="matrixContainer" style="width: 600px;"><div class="matrixRow" style="width: 600px;">
            <div class="noiseBox" style="height: 10px; width: 10px; float: left; background-color: rgb(127, 127, 127);"></div>
            <div class="noiseBox" style="height: 10px; width: 10px; float: left; background-color: rgb(181, 181, 181);"></div>
            <div class="noiseBox" style="height: 10px; width: 10px; float: left; background-color: rgb(127, 127, 127);"></div>
        </div>
           
      </section>
      <script type="codemirror/setup" data-selector="perlin">// http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf
      // Read Stefan's excellent paper for details on how this code works.
      //
      // Sean McCullough banksean@gmail.com
      
      /**
       * You can pass in a random number generator object if you like.
       * It is assumed to have a random() method.
       */
      var SimplexNoise = function(r) {
        if (r == undefined) r = Math;
        this.grad3 = [[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0], 
                                       [1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1], 
                                       [0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]; 
        this.p = [];
        for (var i=0; i<256; i++) {
          this.p[i] = Math.floor(r.random()*256);
        }
        // To remove the need for index wrapping, double the permutation table length 
        this.perm = []; 
        for(var i=0; i<512; i++) {
          this.perm[i]=this.p[i & 255];
        } 
      
        // A lookup table to traverse the simplex around a given point in 4D. 
        // Details can be found where this table is used, in the 4D noise method. 
        this.simplex = [ 
          [0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0], 
          [0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0], 
          [0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0], 
          [1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0], 
          [1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0], 
          [0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0], 
          [2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0], 
          [2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]; 
      };
      
      SimplexNoise.prototype.dot = function(g, x, y) { 
        return g[0]*x + g[1]*y;
      };
      
      SimplexNoise.prototype.noise = function(xin, yin) { 
        var n0, n1, n2; // Noise contributions from the three corners 
        // Skew the input space to determine which simplex cell we're in 
        var F2 = 0.5*(Math.sqrt(3.0)-1.0); 
        var s = (xin+yin)*F2; // Hairy factor for 2D 
        var i = Math.floor(xin+s); 
        var j = Math.floor(yin+s); 
        var G2 = (3.0-Math.sqrt(3.0))/6.0; 
        var t = (i+j)*G2; 
        var X0 = i-t; // Unskew the cell origin back to (x,y) space 
        var Y0 = j-t; 
        var x0 = xin-X0; // The x,y distances from the cell origin 
        var y0 = yin-Y0; 
        // For the 2D case, the simplex shape is an equilateral triangle. 
        // Determine which simplex we are in. 
        var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords 
        if(x0>y0) {i1=1; j1=0;} // lower triangle, XY order: (0,0)->(1,0)->(1,1) 
        else {i1=0; j1=1;}      // upper triangle, YX order: (0,0)->(0,1)->(1,1) 
        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and 
        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where 
        // c = (3-sqrt(3))/6 
        var x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords 
        var y1 = y0 - j1 + G2; 
        var x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords 
        var y2 = y0 - 1.0 + 2.0 * G2; 
        // Work out the hashed gradient indices of the three simplex corners 
        var ii = i & 255; 
        var jj = j & 255; 
        var gi0 = this.perm[ii+this.perm[jj]] % 12; 
        var gi1 = this.perm[ii+i1+this.perm[jj+j1]] % 12; 
        var gi2 = this.perm[ii+1+this.perm[jj+1]] % 12; 
        // Calculate the contribution from the three corners 
        var t0 = 0.5 - x0*x0-y0*y0; 
        if(t0<0) n0 = 0.0; 
        else { 
          t0 *= t0; 
          n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0);  // (x,y) of grad3 used for 2D gradient 
        } 
        var t1 = 0.5 - x1*x1-y1*y1; 
        if(t1<0) n1 = 0.0; 
        else { 
          t1 *= t1; 
          n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1); 
        }
        var t2 = 0.5 - x2*x2-y2*y2; 
        if(t2<0) n2 = 0.0; 
        else { 
          t2 *= t2; 
          n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2); 
        } 
        // Add contributions from each corner to get the final noise value. 
        // The result is scaled to return values in the interval [-1,1]. 
        return 70.0 * (n0 + n1 + n2); 
      };
      
      // 3D simplex noise 
      SimplexNoise.prototype.noise3d = function(xin, yin, zin) { 
        var n0, n1, n2, n3; // Noise contributions from the four corners 
        // Skew the input space to determine which simplex cell we're in 
        var F3 = 1.0/3.0; 
        var s = (xin+yin+zin)*F3; // Very nice and simple skew factor for 3D 
        var i = Math.floor(xin+s); 
        var j = Math.floor(yin+s); 
        var k = Math.floor(zin+s); 
        var G3 = 1.0/6.0; // Very nice and simple unskew factor, too 
        var t = (i+j+k)*G3; 
        var X0 = i-t; // Unskew the cell origin back to (x,y,z) space 
        var Y0 = j-t; 
        var Z0 = k-t; 
        var x0 = xin-X0; // The x,y,z distances from the cell origin 
        var y0 = yin-Y0; 
        var z0 = zin-Z0; 
        // For the 3D case, the simplex shape is a slightly irregular tetrahedron. 
        // Determine which simplex we are in. 
        var i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords 
        var i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords 
        if(x0>=y0) { 
          if(y0>=z0) 
            { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; } // X Y Z order 
            else if(x0>=z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; } // X Z Y order 
            else { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; } // Z X Y order 
          } 
        else { // x0<y0 
          if(y0<z0) { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; } // Z Y X order 
          else if(x0<z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; } // Y Z X order 
          else { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; } // Y X Z order 
        } 
        // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z), 
        // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and 
        // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where 
        // c = 1/6.
        var x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords 
        var y1 = y0 - j1 + G3; 
        var z1 = z0 - k1 + G3; 
        var x2 = x0 - i2 + 2.0*G3; // Offsets for third corner in (x,y,z) coords 
        var y2 = y0 - j2 + 2.0*G3; 
        var z2 = z0 - k2 + 2.0*G3; 
        var x3 = x0 - 1.0 + 3.0*G3; // Offsets for last corner in (x,y,z) coords 
        var y3 = y0 - 1.0 + 3.0*G3; 
        var z3 = z0 - 1.0 + 3.0*G3; 
        // Work out the hashed gradient indices of the four simplex corners 
        var ii = i & 255; 
        var jj = j & 255; 
        var kk = k & 255; 
        var gi0 = this.perm[ii+this.perm[jj+this.perm[kk]]] % 12; 
        var gi1 = this.perm[ii+i1+this.perm[jj+j1+this.perm[kk+k1]]] % 12; 
        var gi2 = this.perm[ii+i2+this.perm[jj+j2+this.perm[kk+k2]]] % 12; 
        var gi3 = this.perm[ii+1+this.perm[jj+1+this.perm[kk+1]]] % 12; 
        // Calculate the contribution from the four corners 
        var t0 = 0.6 - x0*x0 - y0*y0 - z0*z0; 
        if(t0<0) n0 = 0.0; 
        else { 
          t0 *= t0; 
          n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0, z0); 
        }
        var t1 = 0.6 - x1*x1 - y1*y1 - z1*z1; 
        if(t1<0) n1 = 0.0; 
        else { 
          t1 *= t1; 
          n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1, z1); 
        } 
        var t2 = 0.6 - x2*x2 - y2*y2 - z2*z2; 
        if(t2<0) n2 = 0.0; 
        else { 
          t2 *= t2; 
          n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2, z2); 
        } 
        var t3 = 0.6 - x3*x3 - y3*y3 - z3*z3; 
        if(t3<0) n3 = 0.0; 
        else { 
          t3 *= t3; 
          n3 = t3 * t3 * this.dot(this.grad3[gi3], x3, y3, z3); 
        } 
        // Add contributions from each corner to get the final noise value. 
        // The result is scaled to stay just inside [-1,1] 
        return 32.0*(n0 + n1 + n2 + n3); 
      };
      
      $('#perlinContainer').children().remove();</script>
      <div class="codeblock"><div class="codemirror-result"></div><textarea name="codehelper" id="perlin" class="code" mode="" runnable="true" showconsole="true" buttons="run,reset,clear" autorun="true" callbacks-clear="var x = function barf(){ $(&#39;#pieContainer&#39;).children().remove(); $(&#39;#perlinContainer&#39;).html(&#39;&lt;h3&gt;Rendering blocks!&lt;/h3&gt;&#39;); }; x();" callbacks-reset="var x = function barf(){ $(&#39;#pieContainer&#39;).children().remove(); $(&#39;#perlinContainer&#39;).html(&#39;&lt;h3&gt;Rendering blocks!&lt;/h3&gt;&#39;); }; x();" callbacks-run="callback" style="display: none;">// define the dimensions of our grid
var x_size = 50;
var y_size = 50;
var boxSize = 10;

// create our noise maker
var sn = new SimplexNoise();

var matrix = new Miso.Dataset();

// we are going to create a column for all the Y values
for (var row = 0; row &lt; x_size; row++) {
  matrix.addColumn({ 
    name : row, 
    type : 'number' 
  });
}

// now make some values!
for (var column = 0; column &lt; y_size; column++) {
  var rowObject = {};
  matrix.eachColumn(function(columnName, columnObject, rowindex) {
    rowObject[columnName] = sn.noise(column, rowindex);
  });
  matrix.add(rowObject);
}

// save the min and max from the dataset
var minNoise = matrix.min(), 
    maxNoise = matrix.max();

// now we need to map a color to the noise ranges
function getColorFromNoise(noise) {
  var ratio = (noise - minNoise) / (maxNoise - minNoise);
  var v = Math.floor((255) * ratio);
  if (ratio > .05) {
    return 'rgba(0,' + v + ', 0, 1)';
  }
  else {
    return 'rgba(255,0,0,1)';
  }
}

// now we have a matrix with lots of perlin noise
// lets visualize it!
// console.profile("Rendering");
var container = $('&lt;div&gt;', { 
      "class" : "matrixContainer" 
    }).css({ width : x_size * boxSize });

container.appendTo($('#perlinContainer'));

function buildRow(column) {
  
  // create a div container row
  var containerRow = $('&lt;div&gt;', { "class" : "matrixRow" })
    .css({ width : x_size * boxSize, display : 'none' })
    .appendTo(container);

  // create actual noise blocks and append them to the row
  _.each(column.data, function(value, x) {
    var noiseBox = $('&lt;div&gt;', { "class" : "noiseBox" });
    noiseBox.css({
      height: boxSize, 
      width : boxSize, 
      float: "left", 
      "background-color" : getColorFromNoise(value)
    }).appendTo(containerRow);
  });

  return containerRow;
};

// aggregate rows into an array that we can then paint progressively
var containerRows = [];
matrix.eachColumn(function(colName, column, y) {
  containerRows.push(buildRow(column));
}); 

// delay each row painting by an index based offset to 
// create a progressive load.
_.each(containerRows, function(cont, i) {
  setTimeout(function() {
    cont.fadeIn("slow");
  }, i * 100);
});

</textarea><div class="CodeMirror"><div class="button reset">Reset</div><div class="button clear">Clear</div><div class="button">Run</div><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 1580px; left: 80px;"><textarea style="position: absolute; width: 2px;" wrap="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 1670px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span><span class="cm-null">  }, </span><span class="cm-variable-2">i</span><span class="cm-null"> * </span><span class="cm-number">1</span></span></pre></div><div style="position: relative; top: 0px;"><div class="CodeMirror-gutter" style="height: 1670px;"><div class="CodeMirror-gutter-text"><pre>&nbsp;1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre><pre>22</pre><pre>23</pre><pre>24</pre><pre>25</pre><pre>26</pre><pre>27</pre><pre>28</pre><pre>29</pre><pre>30</pre><pre>31</pre><pre>32</pre><pre>33</pre><pre>34</pre><pre>35</pre><pre>36</pre><pre>37</pre><pre>38</pre><pre>39</pre><pre>40</pre><pre>41</pre><pre>42</pre><pre>43</pre><pre>44</pre><pre>45</pre><pre>46</pre><pre>47</pre><pre>48</pre><pre>49</pre><pre>50</pre><pre>51</pre><pre>52</pre><pre>53</pre><pre>54</pre><pre>55</pre><pre>56</pre><pre>57</pre><pre>58</pre><pre>59</pre><pre>60</pre><pre>61</pre><pre>62</pre><pre>63</pre><pre>64</pre><pre>65</pre><pre>66</pre><pre>67</pre><pre>68</pre><pre>69</pre><pre>70</pre><pre>71</pre><pre>72</pre><pre>73</pre><pre>74</pre><pre>75</pre><pre>76</pre><pre>77</pre><pre>78</pre><pre>79</pre><pre>80</pre><pre>81</pre><pre>82</pre><pre>83</pre></div></div><div class="CodeMirror-lines"><div style="position: relative; margin-left: 28px;"><pre class="CodeMirror-cursor" style="top: 1580px; left: 80px;">&nbsp;</pre><div style=""><pre><span class="cm-comment">// define the dimensions of our grid</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">x_size</span><span class="cm-null"> = </span><span class="cm-number">60</span><span class="cm-undefined">;</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">y_size</span><span class="cm-null"> = </span><span class="cm-number">50</span><span class="cm-undefined">;</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">boxSize</span><span class="cm-null"> = </span><span class="cm-number">10</span><span class="cm-undefined">;</span></pre><pre> </pre><pre><span class="cm-comment">// create our noise maker</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">sn</span><span class="cm-null"> = </span><span class="cm-keyword">new</span><span class="cm-null"> </span><span class="cm-variable">SimplexNoise</span><span class="cm-undefined">();</span></pre><pre> </pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">matrix</span><span class="cm-null"> = </span><span class="cm-keyword">new</span><span class="cm-null"> </span><span class="cm-variable">Miso</span><span class="cm-undefined">.</span><span class="cm-property">Dataset</span><span class="cm-undefined">();</span></pre><pre> </pre><pre><span class="cm-comment">// we are going to create a column for all the Y values</span></pre><pre><span class="cm-keyword">for</span><span class="cm-null"> (</span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">row</span><span class="cm-null"> = </span><span class="cm-number">0</span><span class="cm-undefined">; </span><span class="cm-variable">row</span><span class="cm-null"> &lt; </span><span class="cm-variable">x_size</span><span class="cm-undefined">; </span><span class="cm-variable">row</span><span class="cm-null">++) {</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">addColumn</span><span class="cm-undefined">({ </span></pre><pre><span class="cm-null">    </span><span class="cm-property">name</span><span class="cm-null"> : </span><span class="cm-variable">row</span><span class="cm-undefined">, </span></pre><pre><span class="cm-null">    </span><span class="cm-property">type</span><span class="cm-null"> : </span><span class="cm-string">'number'</span><span class="cm-null"> </span></pre><pre><span class="cm-null">  });</span></pre><pre><span class="cm-undefined">}</span></pre><pre> </pre><pre><span class="cm-comment">// now make some values!</span></pre><pre><span class="cm-keyword">for</span><span class="cm-null"> (</span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">column</span><span class="cm-null"> = </span><span class="cm-number">0</span><span class="cm-undefined">; </span><span class="cm-variable">column</span><span class="cm-null"> &lt; </span><span class="cm-variable">y_size</span><span class="cm-undefined">; </span><span class="cm-variable">column</span><span class="cm-null">++) {</span></pre><pre><span class="cm-null">  </span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">rowObject</span><span class="cm-null"> = {};</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">eachColumn</span><span class="cm-undefined">(</span><span class="cm-keyword">function</span><span class="cm-undefined">(</span><span class="cm-def">columnName</span><span class="cm-undefined">, </span><span class="cm-def">columnObject</span><span class="cm-undefined">, </span><span class="cm-def">rowindex</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">    </span><span class="cm-variable">rowObject</span><span class="cm-undefined">[</span><span class="cm-variable-2">columnName</span><span class="cm-undefined">] = </span><span class="cm-variable">sn</span><span class="cm-undefined">.</span><span class="cm-property">noise</span><span class="cm-undefined">(</span><span class="cm-variable">column</span><span class="cm-undefined">, </span><span class="cm-variable-2">rowindex</span><span class="cm-undefined">);</span></pre><pre><span class="cm-null">  });</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">add</span><span class="cm-undefined">(</span><span class="cm-variable">rowObject</span><span class="cm-undefined">);</span></pre><pre><span class="cm-undefined">}</span></pre><pre> </pre><pre><span class="cm-comment">// save the min and max from the dataset</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">minNoise</span><span class="cm-null"> = </span><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">min</span><span class="cm-undefined">(), </span></pre><pre><span class="cm-null">    </span><span class="cm-variable">maxNoise</span><span class="cm-null"> = </span><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">max</span><span class="cm-undefined">();</span></pre><pre> </pre><pre><span class="cm-comment">// now we need to map a color to the noise ranges</span></pre><pre><span class="cm-keyword">function</span><span class="cm-null"> </span><span class="cm-variable">getColorFromNoise</span><span class="cm-undefined">(</span><span class="cm-def">noise</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">  </span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-def">ratio</span><span class="cm-null"> = (</span><span class="cm-variable-2">noise</span><span class="cm-null"> - </span><span class="cm-variable">minNoise</span><span class="cm-undefined">) / (</span><span class="cm-variable">maxNoise</span><span class="cm-null"> - </span><span class="cm-variable">minNoise</span><span class="cm-undefined">);</span></pre><pre><span class="cm-null">  </span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-def">v</span><span class="cm-null"> = </span><span class="cm-variable">Math</span><span class="cm-undefined">.</span><span class="cm-property">floor</span><span class="cm-undefined">((</span><span class="cm-number">255</span><span class="cm-undefined">) * </span><span class="cm-variable-2">ratio</span><span class="cm-undefined">);</span></pre><pre><span class="cm-null">  </span><span class="cm-keyword">return</span><span class="cm-null"> </span><span class="cm-string">'rgba('</span><span class="cm-null"> + </span><span class="cm-variable-2">v</span><span class="cm-null"> + </span><span class="cm-string">','</span><span class="cm-null"> + </span><span class="cm-variable-2">v</span><span class="cm-null"> + </span><span class="cm-string">','</span><span class="cm-null"> + </span><span class="cm-variable-2">v</span><span class="cm-null"> + </span><span class="cm-string">', 1)'</span><span class="cm-undefined">;</span></pre><pre><span class="cm-undefined">}</span></pre><pre> </pre><pre><span class="cm-comment">// now we have a matrix with lots of perlin noise</span></pre><pre><span class="cm-comment">// lets visualize it!</span></pre><pre><span class="cm-comment">// console.profile("Rendering");</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">container</span><span class="cm-null"> = </span><span class="cm-variable">$</span><span class="cm-undefined">(</span><span class="cm-string">'&lt;div&gt;'</span><span class="cm-undefined">, { </span></pre><pre><span class="cm-null">      </span><span class="cm-string">"class"</span><span class="cm-null"> : </span><span class="cm-string">"matrixContainer"</span><span class="cm-null"> </span></pre><pre><span class="cm-null">    }).</span><span class="cm-property">css</span><span class="cm-undefined">({ </span><span class="cm-property">width</span><span class="cm-null"> : </span><span class="cm-variable">x_size</span><span class="cm-null"> * </span><span class="cm-variable">boxSize</span><span class="cm-null"> });</span></pre><pre> </pre><pre><span class="cm-variable">container</span><span class="cm-undefined">.</span><span class="cm-property">appendTo</span><span class="cm-undefined">(</span><span class="cm-variable">$</span><span class="cm-undefined">(</span><span class="cm-string">'#perlinContainer'</span><span class="cm-undefined">));</span></pre><pre> </pre><pre><span class="cm-keyword">function</span><span class="cm-null"> </span><span class="cm-variable">buildRow</span><span class="cm-undefined">(</span><span class="cm-def">column</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">  </span></pre><pre><span class="cm-null">  </span><span class="cm-comment">// create a div container row</span></pre><pre><span class="cm-null">  </span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-def">containerRow</span><span class="cm-null"> = </span><span class="cm-variable">$</span><span class="cm-undefined">(</span><span class="cm-string">'&lt;div&gt;'</span><span class="cm-undefined">, { </span><span class="cm-string">"class"</span><span class="cm-null"> : </span><span class="cm-string">"matrixRow"</span><span class="cm-null"> })</span></pre><pre><span class="cm-null">    .</span><span class="cm-property">css</span><span class="cm-undefined">({ </span><span class="cm-property">width</span><span class="cm-null"> : </span><span class="cm-variable">x_size</span><span class="cm-null"> * </span><span class="cm-variable">boxSize</span><span class="cm-undefined">, </span><span class="cm-property">display</span><span class="cm-null"> : </span><span class="cm-string">'none'</span><span class="cm-null"> })</span></pre><pre><span class="cm-null">    .</span><span class="cm-property">appendTo</span><span class="cm-undefined">(</span><span class="cm-variable">container</span><span class="cm-undefined">);</span></pre><pre> </pre><pre><span class="cm-null">  </span><span class="cm-comment">// create actual noise blocks and append them to the row</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">_</span><span class="cm-undefined">.</span><span class="cm-property">each</span><span class="cm-undefined">(</span><span class="cm-variable-2">column</span><span class="cm-undefined">.</span><span class="cm-property">data</span><span class="cm-undefined">, </span><span class="cm-keyword">function</span><span class="cm-undefined">(</span><span class="cm-def">value</span><span class="cm-undefined">, </span><span class="cm-def">x</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-def">noiseBox</span><span class="cm-null"> = </span><span class="cm-variable">$</span><span class="cm-undefined">(</span><span class="cm-string">'&lt;div&gt;'</span><span class="cm-undefined">, { </span><span class="cm-string">"class"</span><span class="cm-null"> : </span><span class="cm-string">"noiseBox"</span><span class="cm-null"> });</span></pre><pre><span class="cm-null">    </span><span class="cm-variable-2">noiseBox</span><span class="cm-undefined">.</span><span class="cm-property">css</span><span class="cm-undefined">({</span></pre><pre><span class="cm-null">      </span><span class="cm-property">height</span><span class="cm-undefined">: </span><span class="cm-variable">boxSize</span><span class="cm-undefined">, </span></pre><pre><span class="cm-null">      </span><span class="cm-property">width</span><span class="cm-null"> : </span><span class="cm-variable">boxSize</span><span class="cm-undefined">, </span></pre><pre><span class="cm-null">      </span><span class="cm-property">float</span><span class="cm-undefined">: </span><span class="cm-string">"left"</span><span class="cm-undefined">, </span></pre><pre><span class="cm-null">      </span><span class="cm-string">"background-color"</span><span class="cm-null"> : </span><span class="cm-variable">getColorFromNoise</span><span class="cm-undefined">(</span><span class="cm-variable-2">value</span><span class="cm-undefined">)</span></pre><pre><span class="cm-null">    }).</span><span class="cm-property">appendTo</span><span class="cm-undefined">(</span><span class="cm-variable-2">containerRow</span><span class="cm-undefined">);</span></pre><pre><span class="cm-null">  });</span></pre><pre> </pre><pre><span class="cm-null">  </span><span class="cm-keyword">return</span><span class="cm-null"> </span><span class="cm-variable-2">containerRow</span><span class="cm-undefined">;</span></pre><pre><span class="cm-undefined">};</span></pre><pre> </pre><pre><span class="cm-comment">// aggregate rows into an array that we can then paint progressively</span></pre><pre><span class="cm-keyword">var</span><span class="cm-null"> </span><span class="cm-variable">containerRows</span><span class="cm-null"> = [];</span></pre><pre><span class="cm-variable">matrix</span><span class="cm-undefined">.</span><span class="cm-property">eachColumn</span><span class="cm-undefined">(</span><span class="cm-keyword">function</span><span class="cm-undefined">(</span><span class="cm-def">colName</span><span class="cm-undefined">, </span><span class="cm-def">column</span><span class="cm-undefined">, </span><span class="cm-def">y</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">containerRows</span><span class="cm-undefined">.</span><span class="cm-property">push</span><span class="cm-undefined">(</span><span class="cm-variable">buildRow</span><span class="cm-undefined">(</span><span class="cm-variable-2">column</span><span class="cm-undefined">));</span></pre><pre><span class="cm-undefined">}); </span></pre><pre> </pre><pre><span class="cm-comment">// delay each row painting by an index based offset to </span></pre><pre><span class="cm-comment">// create a progressive load.</span></pre><pre><span class="cm-variable">_</span><span class="cm-undefined">.</span><span class="cm-property">each</span><span class="cm-undefined">(</span><span class="cm-variable">containerRows</span><span class="cm-undefined">, </span><span class="cm-keyword">function</span><span class="cm-undefined">(</span><span class="cm-def">cont</span><span class="cm-undefined">, </span><span class="cm-def">i</span><span class="cm-undefined">) {</span></pre><pre><span class="cm-null">  </span><span class="cm-variable">setTimeout</span><span class="cm-undefined">(</span><span class="cm-keyword">function</span><span class="cm-undefined">() {</span></pre><pre><span class="cm-null">    </span><span class="cm-variable-2">cont</span><span class="cm-undefined">.</span><span class="cm-property">fadeIn</span><span class="cm-undefined">(</span><span class="cm-string">"slow"</span><span class="cm-undefined">);</span></pre><pre><span class="cm-null">  }, </span><span class="cm-variable-2">i</span><span class="cm-null"> * </span><span class="cm-number">1</span><span class="cm-undefined">);</span></pre><pre><span class="cm-undefined">});</span></pre><pre> </pre><pre> </pre></div></div></div></div></div></div></div><div class="helptext">You can edit the code in this block and rerun it.</div></div>
    </article>
    <footer>
      <div class="container">
        <section>
          <h2>
            Based on
          </h2>
          <div class="content">
            <a href="http://misoproject.com/">
              <img alt="Miso Project" src="http://misoproject.com/images/logo.png">
            </a>
          </div>
        </section>
      </div>
    </footer>

    <script src="js/jquery.min.js"></script>
    <script src="js/nav.js"></script>
    <script src="js/miso.ds.deps.js"></script>
    <script src="js/transition.js"></script>
    <script src="js/collapse.js"></script>
    <script src="js/codemirror.js"></script>
    <script src="js/codeblocks.js"></script>

</body></html>
